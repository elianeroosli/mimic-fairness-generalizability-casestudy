TRAINING THE CHANNEL-WISE LSTM without additional data
/share/pi/boussard/eroosli_work/benchmarking/models/ihm/main.py:10: DeprecationWarning: the imp module is deprecated in favour of importlib; see the module's documentation for alternative uses
  import imp
Using TensorFlow backend.
2020-06-01 17:11:28.025720: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libnvinfer.so.6'; dlerror: libnvinfer.so.6: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /share/sw/open/oracle/18.5.0.0/lib/:
2020-06-01 17:11:28.033403: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libnvinfer_plugin.so.6'; dlerror: libnvinfer_plugin.so.6: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /share/sw/open/oracle/18.5.0.0/lib/:
2020-06-01 17:11:28.033424: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:30] Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
normalizer state: /share/pi/boussard/eroosli_work/benchmarking/models/ihm/ihm_ts1.0.input_str_previous.start_time_zero.normalizer
==> using model models/keras_models/channel_wise_lstms.py
76
==> not used params in network class: dict_keys(['batch_size', 'beta_1', 'data', 'data_name', 'epochs', 'imputation', 'l1', 'l2', 'load_state', 'lr', 'mode', 'network', 'normalizer_state', 'optimizer', 'output_dir', 'prefix', 'save_every', 'small_part', 'target_repl_coef', 'timestep', 'verbose'])
==> excluded demographics: ['Ethnicity', 'Gender', 'Insurance']
==> found 17 channels: ['Capillary refill rate', 'Diastolic blood pressure', 'Fraction inspired oxygen', 'Glascow coma scale eye opening', 'Glascow coma scale motor response', 'Glascow coma scale total', 'Glascow coma scale verbal response', 'Glucose', 'Heart rate', 'Height', 'Mean blood pressure', 'Oxygen saturation', 'Respiratory rate', 'Systolic blood pressure', 'Temperature', 'Weight', 'pH']
2020-06-01 17:11:33.223000: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory; LD_LIBRARY_PATH: /share/sw/open/oracle/18.5.0.0/lib/:
2020-06-01 17:11:33.223038: E tensorflow/stream_executor/cuda/cuda_driver.cc:351] failed call to cuInit: UNKNOWN ERROR (303)
2020-06-01 17:11:33.223067: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (slurm-compute-4vw5f): /proc/driver/nvidia/version does not exist
2020-06-01 17:11:33.223246: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 AVX512F FMA
2020-06-01 17:11:33.247867: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 2100000000 Hz
2020-06-01 17:11:33.248153: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x562bbd88da80 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2020-06-01 17:11:33.248186: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
==> model.final_name: 2020-06-01_10-11.k_clstms.none
==> compiling the model
Model: "network_1"
__________________________________________________________________________________________________
Layer (type)                    Output Shape         Param #     Connected to                     
==================================================================================================
X (InputLayer)                  (None, None, 76)     0                                            
__________________________________________________________________________________________________
masking_1 (Masking)             (None, None, 76)     0           X[0][0]                          
__________________________________________________________________________________________________
slice_1 (Slice)                 (None, None, 3)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_2 (Slice)                 (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_3 (Slice)                 (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_4 (Slice)                 (None, None, 9)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_5 (Slice)                 (None, None, 13)     0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_6 (Slice)                 (None, None, 14)     0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_7 (Slice)                 (None, None, 13)     0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_8 (Slice)                 (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_9 (Slice)                 (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_10 (Slice)                (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_11 (Slice)                (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_12 (Slice)                (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_13 (Slice)                (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_14 (Slice)                (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_15 (Slice)                (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_16 (Slice)                (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
slice_17 (Slice)                (None, None, 2)      0           masking_1[0][0]                  
__________________________________________________________________________________________________
bidirectional_1 (Bidirectional) (None, None, 8)      256         slice_1[0][0]                    
__________________________________________________________________________________________________
bidirectional_2 (Bidirectional) (None, None, 8)      224         slice_2[0][0]                    
__________________________________________________________________________________________________
bidirectional_3 (Bidirectional) (None, None, 8)      224         slice_3[0][0]                    
__________________________________________________________________________________________________
bidirectional_4 (Bidirectional) (None, None, 8)      448         slice_4[0][0]                    
__________________________________________________________________________________________________
bidirectional_5 (Bidirectional) (None, None, 8)      576         slice_5[0][0]                    
__________________________________________________________________________________________________
bidirectional_6 (Bidirectional) (None, None, 8)      608         slice_6[0][0]                    
__________________________________________________________________________________________________
bidirectional_7 (Bidirectional) (None, None, 8)      576         slice_7[0][0]                    
__________________________________________________________________________________________________
bidirectional_8 (Bidirectional) (None, None, 8)      224         slice_8[0][0]                    
__________________________________________________________________________________________________
bidirectional_9 (Bidirectional) (None, None, 8)      224         slice_9[0][0]                    
__________________________________________________________________________________________________
bidirectional_10 (Bidirectional (None, None, 8)      224         slice_10[0][0]                   
__________________________________________________________________________________________________
bidirectional_11 (Bidirectional (None, None, 8)      224         slice_11[0][0]                   
__________________________________________________________________________________________________
bidirectional_12 (Bidirectional (None, None, 8)      224         slice_12[0][0]                   
__________________________________________________________________________________________________
bidirectional_13 (Bidirectional (None, None, 8)      224         slice_13[0][0]                   
__________________________________________________________________________________________________
bidirectional_14 (Bidirectional (None, None, 8)      224         slice_14[0][0]                   
__________________________________________________________________________________________________
bidirectional_15 (Bidirectional (None, None, 8)      224         slice_15[0][0]                   
__________________________________________________________________________________________________
bidirectional_16 (Bidirectional (None, None, 8)      224         slice_16[0][0]                   
__________________________________________________________________________________________________
bidirectional_17 (Bidirectional (None, None, 8)      224         slice_17[0][0]                   
__________________________________________________________________________________________________
concatenate_1 (Concatenate)     (None, None, 136)    0           bidirectional_1[0][0]            
                                                                 bidirectional_2[0][0]            
                                                                 bidirectional_3[0][0]            
                                                                 bidirectional_4[0][0]            
                                                                 bidirectional_5[0][0]            
                                                                 bidirectional_6[0][0]            
                                                                 bidirectional_7[0][0]            
                                                                 bidirectional_8[0][0]            
                                                                 bidirectional_9[0][0]            
                                                                 bidirectional_10[0][0]           
                                                                 bidirectional_11[0][0]           
                                                                 bidirectional_12[0][0]           
                                                                 bidirectional_13[0][0]           
                                                                 bidirectional_14[0][0]           
                                                                 bidirectional_15[0][0]           
                                                                 bidirectional_16[0][0]           
                                                                 bidirectional_17[0][0]           
__________________________________________________________________________________________________
lstm_18 (LSTM)                  (None, 32)           21632       concatenate_1[0][0]              
__________________________________________________________________________________________________
dropout_1 (Dropout)             (None, 32)           0           lstm_18[0][0]                    
__________________________________________________________________________________________________
dense_1 (Dense)                 (None, 1)            33          dropout_1[0][0]                  
==================================================================================================
Total params: 26,817
Trainable params: 26,817
Non-trainable params: 0
__________________________________________________________________________________________________
==> training
Train on 4628 samples, validate on 817 samples
Epoch 1/100
 - 278s - loss: 0.3071 - val_loss: 0.2609

==>predicting on train



confusion matrix:
[[2154    1]
 [ 240   15]]

stratified metric for:
demographic variable: Insurance
value: Medicare

overall metrics:
prevalence of IHM = 0.105809
average predicted risk of IHM = 0.07238899916410446
difference in average predicted and observed risk = -0.03342000083589554
number samples = 2410
accuracy = 0.9
precision class 0 = 0.899749
precision class 1 = 0.9375
recall class 0 = 0.999536
recall class 1 = 0.058824
false negative rate = 0.941176
false positive rate = 0.000464
positive prediction rate = 0.006639
AUC of ROC = 0.807734
AUC of PRC = 0.42748
min(+P, Se) = 0.415385

-------------------------------

confusion matrix:
[[1169   10]
 [ 113    5]]

stratified metric for:
demographic variable: Insurance
value: Private

overall metrics:
prevalence of IHM = 0.090979
average predicted risk of IHM = 0.07930099964141846
difference in average predicted and observed risk = -0.011678000358581547
number samples = 1297
accuracy = 0.905166
precision class 0 = 0.911856
precision class 1 = 0.333333
recall class 0 = 0.991518
recall class 1 = 0.042373
false negative rate = 0.957627
false positive rate = 0.008482
positive prediction rate = 0.011565
AUC of ROC = 0.824945
AUC of PRC = 0.322922
min(+P, Se) = 0.398601

-------------------------------

confusion matrix:
[[653   3]
 [ 67   7]]

stratified metric for:
demographic variable: Insurance
value: Medicaid

overall metrics:
prevalence of IHM = 0.10137
average predicted risk of IHM = 0.08491899818181992
difference in average predicted and observed risk = -0.016451001818180086
number samples = 730
accuracy = 0.90411
precision class 0 = 0.906944
precision class 1 = 0.7
recall class 0 = 0.995427
recall class 1 = 0.094595
false negative rate = 0.905405
false positive rate = 0.004573
positive prediction rate = 0.013699
AUC of ROC = 0.7974
AUC of PRC = 0.41172
min(+P, Se) = 0.407895

-------------------------------

confusion matrix:
[[166   1]
 [ 19   5]]

stratified metric for:
demographic variable: Insurance
value: Other

overall metrics:
prevalence of IHM = 0.125654
average predicted risk of IHM = 0.08302000164985657
difference in average predicted and observed risk = -0.04263399835014342
number samples = 191
accuracy = 0.895288
precision class 0 = 0.897297
precision class 1 = 0.833333
recall class 0 = 0.994012
recall class 1 = 0.208333
false negative rate = 0.791667
false positive rate = 0.005988
positive prediction rate = 0.031414
AUC of ROC = 0.85978
AUC of PRC = 0.650823
min(+P, Se) = 0.625

-------------------------------

confusion matrix:
[[2464   10]
 [ 242   13]]

stratified metric for:
demographic variable: Gender
value: M

overall metrics:
prevalence of IHM = 0.093441
average predicted risk of IHM = 0.07126600295305252
difference in average predicted and observed risk = -0.022174997046947476
number samples = 2729
accuracy = 0.907658
precision class 0 = 0.910569
precision class 1 = 0.565217
recall class 0 = 0.995958
recall class 1 = 0.05098
false negative rate = 0.94902
false positive rate = 0.004042
positive prediction rate = 0.008428
AUC of ROC = 0.814138
AUC of PRC = 0.362665
min(+P, Se) = 0.400778

-------------------------------

confusion matrix:
[[1678    5]
 [ 197   19]]

stratified metric for:
demographic variable: Gender
value: F

overall metrics:
prevalence of IHM = 0.113744
average predicted risk of IHM = 0.0846090018749237
difference in average predicted and observed risk = -0.029134998125076292
number samples = 1899
accuracy = 0.893628
precision class 0 = 0.894933
precision class 1 = 0.791667
recall class 0 = 0.997029
recall class 1 = 0.087963
false negative rate = 0.912037
false positive rate = 0.002971
positive prediction rate = 0.012638
AUC of ROC = 0.811038
AUC of PRC = 0.426484
min(+P, Se) = 0.444444

-------------------------------

confusion matrix:
[[547   2]
 [ 72   5]]

stratified metric for:
demographic variable: Ethnicity
value: ASIAN

overall metrics:
prevalence of IHM = 0.123003
average predicted risk of IHM = 0.08485099673271179
difference in average predicted and observed risk = -0.03815200326728821
number samples = 626
accuracy = 0.881789
precision class 0 = 0.883683
precision class 1 = 0.714286
recall class 0 = 0.996357
recall class 1 = 0.064935
false negative rate = 0.935065
false positive rate = 0.003643
positive prediction rate = 0.011182
AUC of ROC = 0.839259
AUC of PRC = 0.416662
min(+P, Se) = 0.4625

-------------------------------

confusion matrix:
[[2246    3]
 [ 203    5]]

stratified metric for:
demographic variable: Ethnicity
value: WHITE

overall metrics:
prevalence of IHM = 0.084656
average predicted risk of IHM = 0.06679899990558624
difference in average predicted and observed risk = -0.017857000094413752
number samples = 2457
accuracy = 0.916158
precision class 0 = 0.917109
precision class 1 = 0.625
recall class 0 = 0.998666
recall class 1 = 0.024038
false negative rate = 0.975962
false positive rate = 0.001334
positive prediction rate = 0.003256
AUC of ROC = 0.806059
AUC of PRC = 0.328833
min(+P, Se) = 0.346154

-------------------------------

confusion matrix:
[[219   4]
 [ 24   1]]

stratified metric for:
demographic variable: Ethnicity
value: BLACK

overall metrics:
prevalence of IHM = 0.100806
average predicted risk of IHM = 0.07784699648618698
difference in average predicted and observed risk = -0.022959003513813026
number samples = 248
accuracy = 0.887097
precision class 0 = 0.901235
precision class 1 = 0.2
recall class 0 = 0.982063
recall class 1 = 0.04
false negative rate = 0.96
false positive rate = 0.017937
positive prediction rate = 0.020161
AUC of ROC = 0.6913
AUC of PRC = 0.212078
min(+P, Se) = 0.333333

-------------------------------

confusion matrix:
[[477   4]
 [ 71  11]]

stratified metric for:
demographic variable: Ethnicity
value: OTHER

overall metrics:
prevalence of IHM = 0.145648
average predicted risk of IHM = 0.0954660028219223
difference in average predicted and observed risk = -0.0501819971780777
number samples = 563
accuracy = 0.866785
precision class 0 = 0.870438
precision class 1 = 0.733333
recall class 0 = 0.991684
recall class 1 = 0.134146
false negative rate = 0.865854
false positive rate = 0.008316
positive prediction rate = 0.026643
AUC of ROC = 0.840044
AUC of PRC = 0.566593
min(+P, Se) = 0.597561

-------------------------------

confusion matrix:
[[653   2]
 [ 69  10]]

stratified metric for:
demographic variable: Ethnicity
value: HISPANIC

overall metrics:
prevalence of IHM = 0.107629
average predicted risk of IHM = 0.08836700022220612
difference in average predicted and observed risk = -0.019261999777793887
number samples = 734
accuracy = 0.90327
precision class 0 = 0.904432
precision class 1 = 0.833333
recall class 0 = 0.996947
recall class 1 = 0.126582
false negative rate = 0.873418
false positive rate = 0.003053
positive prediction rate = 0.016349
AUC of ROC = 0.805604
AUC of PRC = 0.434721
min(+P, Se) = 0.427083

-------------------------------

confusion matrix:
[[4142   15]
 [ 439   32]]
prevalence of IHM = 0.101772
average predicted risk of IHM = 0.07674100250005722
difference in average predicted and observed risk = -0.02503099749994278
number samples = 4628
accuracy = 0.901901
precision class 0 = 0.904169
precision class 1 = 0.680851
recall class 0 = 0.996392
recall class 1 = 0.067941
false negative rate = 0.932059
false positive rate = 0.003608
positive prediction rate = 0.010156
AUC of ROC = 0.812794
AUC of PRC = 0.392296
min(+P, Se) = 0.426752

-------------------------------

==>predicting on validation



confusion matrix:
[[216   2]
 [ 17   2]]

stratified metric for:
demographic variable: Insurance
value: Private

overall metrics:
prevalence of IHM = 0.080169
average predicted risk of IHM = 0.0802920013666153
difference in average predicted and observed risk = 0.00012300136661529126
number samples = 237
accuracy = 0.919831
precision class 0 = 0.927039
precision class 1 = 0.5
recall class 0 = 0.990826
recall class 1 = 0.105263
false negative rate = 0.894737
false positive rate = 0.009174
positive prediction rate = 0.016878
AUC of ROC = 0.88001
AUC of PRC = 0.361137
min(+P, Se) = 0.47619

-------------------------------

confusion matrix:
[[385   0]
 [ 47   0]]
/share/pi/boussard/eroosli_work/benchmarking/models/evaluation/metrics.py:34: RuntimeWarning: invalid value encountered in float_scalars
  prec1 = np.round(float(cf[1][1] / (cf[1][1] + cf[0][1])),6)

stratified metric for:
demographic variable: Insurance
value: Medicare

overall metrics:
prevalence of IHM = 0.108796
average predicted risk of IHM = 0.07301100343465805
difference in average predicted and observed risk = -0.03578499656534195
number samples = 432
accuracy = 0.891204
precision class 0 = 0.891204
precision class 1 = nan
recall class 0 = 1.0
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.0
positive prediction rate = 0.0
AUC of ROC = 0.831721
AUC of PRC = 0.447943
min(+P, Se) = 0.425532

-------------------------------

confusion matrix:
[[105   0]
 [ 10   3]]

stratified metric for:
demographic variable: Insurance
value: Medicaid

overall metrics:
prevalence of IHM = 0.110169
average predicted risk of IHM = 0.09557799994945526
difference in average predicted and observed risk = -0.014591000050544742
number samples = 118
accuracy = 0.915254
precision class 0 = 0.913043
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.230769
false negative rate = 0.769231
false positive rate = 0.0
positive prediction rate = 0.025424
AUC of ROC = 0.871795
AUC of PRC = 0.653971
min(+P, Se) = 0.769231

-------------------------------

confusion matrix:
[[26  0]
 [ 4  0]]
/share/pi/boussard/eroosli_work/benchmarking/models/evaluation/metrics.py:34: RuntimeWarning: invalid value encountered in float_scalars
  prec1 = np.round(float(cf[1][1] / (cf[1][1] + cf[0][1])),6)

stratified metric for:
demographic variable: Insurance
value: Other

overall metrics:
prevalence of IHM = 0.133333
average predicted risk of IHM = 0.08205000311136246
difference in average predicted and observed risk = -0.05128299688863755
number samples = 30
accuracy = 0.866667
precision class 0 = 0.866667
precision class 1 = nan
recall class 0 = 1.0
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.0
positive prediction rate = 0.0
AUC of ROC = 1.0
AUC of PRC = 1.0
min(+P, Se) = 1.0

-------------------------------

confusion matrix:
[[299   1]
 [ 37   2]]

stratified metric for:
demographic variable: Gender
value: F

overall metrics:
prevalence of IHM = 0.115044
average predicted risk of IHM = 0.08708500117063522
difference in average predicted and observed risk = -0.02795899882936477
number samples = 339
accuracy = 0.887906
precision class 0 = 0.889881
precision class 1 = 0.666667
recall class 0 = 0.996667
recall class 1 = 0.051282
false negative rate = 0.948718
false positive rate = 0.003333
positive prediction rate = 0.00885
AUC of ROC = 0.828632
AUC of PRC = 0.404438
min(+P, Se) = 0.463415

-------------------------------

confusion matrix:
[[433   1]
 [ 41   3]]

stratified metric for:
demographic variable: Gender
value: M

overall metrics:
prevalence of IHM = 0.09205
average predicted risk of IHM = 0.07277899980545044
difference in average predicted and observed risk = -0.019271000194549567
number samples = 478
accuracy = 0.912134
precision class 0 = 0.913502
precision class 1 = 0.75
recall class 0 = 0.997696
recall class 1 = 0.068182
false negative rate = 0.931818
false positive rate = 0.002304
positive prediction rate = 0.008368
AUC of ROC = 0.875733
AUC of PRC = 0.486724
min(+P, Se) = 0.545455

-------------------------------

confusion matrix:
[[388   0]
 [ 36   2]]

stratified metric for:
demographic variable: Ethnicity
value: WHITE

overall metrics:
prevalence of IHM = 0.089202
average predicted risk of IHM = 0.07078299671411514
difference in average predicted and observed risk = -0.01841900328588486
number samples = 426
accuracy = 0.915493
precision class 0 = 0.915094
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.052632
false negative rate = 0.947368
false positive rate = 0.0
positive prediction rate = 0.004695
AUC of ROC = 0.854653
AUC of PRC = 0.452781
min(+P, Se) = 0.5

-------------------------------

confusion matrix:
[[90  0]
 [11  1]]

stratified metric for:
demographic variable: Ethnicity
value: OTHER

overall metrics:
prevalence of IHM = 0.117647
average predicted risk of IHM = 0.08687800168991089
difference in average predicted and observed risk = -0.030768998310089113
number samples = 102
accuracy = 0.892157
precision class 0 = 0.891089
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.083333
false negative rate = 0.916667
false positive rate = 0.0
positive prediction rate = 0.009804
AUC of ROC = 0.900926
AUC of PRC = 0.618788
min(+P, Se) = 0.583333

-------------------------------

confusion matrix:
[[112   1]
 [ 11   0]]

stratified metric for:
demographic variable: Ethnicity
value: ASIAN

overall metrics:
prevalence of IHM = 0.08871
average predicted risk of IHM = 0.07556000351905823
difference in average predicted and observed risk = -0.01314999648094177
number samples = 124
accuracy = 0.903226
precision class 0 = 0.910569
precision class 1 = 0.0
recall class 0 = 0.99115
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.00885
positive prediction rate = 0.008065
AUC of ROC = 0.835076
AUC of PRC = 0.30474
min(+P, Se) = 0.4

-------------------------------

confusion matrix:
[[107   1]
 [ 17   2]]

stratified metric for:
demographic variable: Ethnicity
value: HISPANIC

overall metrics:
prevalence of IHM = 0.149606
average predicted risk of IHM = 0.09418299794197083
difference in average predicted and observed risk = -0.055423002058029164
number samples = 127
accuracy = 0.858268
precision class 0 = 0.862903
precision class 1 = 0.666667
recall class 0 = 0.990741
recall class 1 = 0.105263
false negative rate = 0.894737
false positive rate = 0.009259
positive prediction rate = 0.023622
AUC of ROC = 0.851852
AUC of PRC = 0.547765
min(+P, Se) = 0.55

-------------------------------

confusion matrix:
[[35  0]
 [ 3  0]]
/share/pi/boussard/eroosli_work/benchmarking/models/evaluation/metrics.py:34: RuntimeWarning: invalid value encountered in float_scalars
  prec1 = np.round(float(cf[1][1] / (cf[1][1] + cf[0][1])),6)

stratified metric for:
demographic variable: Ethnicity
value: BLACK

overall metrics:
prevalence of IHM = 0.078947
average predicted risk of IHM = 0.10431300103664398
difference in average predicted and observed risk = 0.02536600103664398
number samples = 38
accuracy = 0.921053
precision class 0 = 0.921053
precision class 1 = nan
recall class 0 = 1.0
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.0
positive prediction rate = 0.0
AUC of ROC = 0.92381
AUC of PRC = 0.549206
min(+P, Se) = 0.428571

-------------------------------

confusion matrix:
[[732   2]
 [ 78   5]]
prevalence of IHM = 0.101591
average predicted risk of IHM = 0.0787149965763092
difference in average predicted and observed risk = -0.022876003423690797
number samples = 817
accuracy = 0.902081
precision class 0 = 0.903704
precision class 1 = 0.714286
recall class 0 = 0.997275
recall class 1 = 0.060241
false negative rate = 0.939759
false positive rate = 0.002725
positive prediction rate = 0.008568
AUC of ROC = 0.857145
AUC of PRC = 0.456551
min(+P, Se) = 0.493976

-------------------------------

Epoch 00001: saving model to models/outputs/starr/keras_states/2020-06-01_10-11/k_clstms.none.epoch1.state
Epoch 2/100
 - 260s - loss: 0.2870 - val_loss: 0.2564

==>predicting on train



confusion matrix:
[[2155    0]
 [ 248    7]]

stratified metric for:
demographic variable: Insurance
value: Medicare

overall metrics:
prevalence of IHM = 0.105809
average predicted risk of IHM = 0.06281200051307678
difference in average predicted and observed risk = -0.04299699948692322
number samples = 2410
accuracy = 0.897095
precision class 0 = 0.896796
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.027451
false negative rate = 0.972549
false positive rate = 0.0
positive prediction rate = 0.002905
AUC of ROC = 0.804517
AUC of PRC = 0.418513
min(+P, Se) = 0.417969

-------------------------------

confusion matrix:
[[1175    4]
 [ 116    2]]

stratified metric for:
demographic variable: Insurance
value: Private

overall metrics:
prevalence of IHM = 0.090979
average predicted risk of IHM = 0.06859400123357773
difference in average predicted and observed risk = -0.022384998766422276
number samples = 1297
accuracy = 0.907479
precision class 0 = 0.910147
precision class 1 = 0.333333
recall class 0 = 0.996607
recall class 1 = 0.016949
false negative rate = 0.983051
false positive rate = 0.003393
positive prediction rate = 0.004626
AUC of ROC = 0.830523
AUC of PRC = 0.332247
min(+P, Se) = 0.415254

-------------------------------

confusion matrix:
[[656   0]
 [ 69   5]]

stratified metric for:
demographic variable: Insurance
value: Medicaid

overall metrics:
prevalence of IHM = 0.10137
average predicted risk of IHM = 0.07829400151968002
difference in average predicted and observed risk = -0.02307599848031998
number samples = 730
accuracy = 0.905479
precision class 0 = 0.904828
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.067568
false negative rate = 0.932432
false positive rate = 0.0
positive prediction rate = 0.006849
AUC of ROC = 0.798224
AUC of PRC = 0.404015
min(+P, Se) = 0.405405

-------------------------------

confusion matrix:
[[167   0]
 [ 21   3]]

stratified metric for:
demographic variable: Insurance
value: Other

overall metrics:
prevalence of IHM = 0.125654
average predicted risk of IHM = 0.07298199832439423
difference in average predicted and observed risk = -0.05267200167560576
number samples = 191
accuracy = 0.890052
precision class 0 = 0.888298
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.125
false negative rate = 0.875
false positive rate = 0.0
positive prediction rate = 0.015707
AUC of ROC = 0.879242
AUC of PRC = 0.674618
min(+P, Se) = 0.625

-------------------------------

confusion matrix:
[[2472    2]
 [ 248    7]]

stratified metric for:
demographic variable: Gender
value: M

overall metrics:
prevalence of IHM = 0.093441
average predicted risk of IHM = 0.06183699890971184
difference in average predicted and observed risk = -0.03160400109028816
number samples = 2729
accuracy = 0.908391
precision class 0 = 0.908824
precision class 1 = 0.777778
recall class 0 = 0.999192
recall class 1 = 0.027451
false negative rate = 0.972549
false positive rate = 0.000808
positive prediction rate = 0.003298
AUC of ROC = 0.811744
AUC of PRC = 0.377088
min(+P, Se) = 0.380392

-------------------------------

confusion matrix:
[[1681    2]
 [ 206   10]]

stratified metric for:
demographic variable: Gender
value: F

overall metrics:
prevalence of IHM = 0.113744
average predicted risk of IHM = 0.07513699680566788
difference in average predicted and observed risk = -0.03860700319433212
number samples = 1899
accuracy = 0.890469
precision class 0 = 0.890832
precision class 1 = 0.833333
recall class 0 = 0.998812
recall class 1 = 0.046296
false negative rate = 0.953704
false positive rate = 0.001188
positive prediction rate = 0.006319
AUC of ROC = 0.81591
AUC of PRC = 0.423779
min(+P, Se) = 0.458333

-------------------------------

confusion matrix:
[[547   2]
 [ 74   3]]

stratified metric for:
demographic variable: Ethnicity
value: ASIAN

overall metrics:
prevalence of IHM = 0.123003
average predicted risk of IHM = 0.07551299780607224
difference in average predicted and observed risk = -0.047490002193927766
number samples = 626
accuracy = 0.878594
precision class 0 = 0.880837
precision class 1 = 0.6
recall class 0 = 0.996357
recall class 1 = 0.038961
false negative rate = 0.961039
false positive rate = 0.003643
positive prediction rate = 0.007987
AUC of ROC = 0.828567
AUC of PRC = 0.407592
min(+P, Se) = 0.43038

-------------------------------

confusion matrix:
[[2249    0]
 [ 206    2]]

stratified metric for:
demographic variable: Ethnicity
value: WHITE

overall metrics:
prevalence of IHM = 0.084656
average predicted risk of IHM = 0.056554000824689865
difference in average predicted and observed risk = -0.02810199917531013
number samples = 2457
accuracy = 0.916158
precision class 0 = 0.91609
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.009615
false negative rate = 0.990385
false positive rate = 0.0
positive prediction rate = 0.000814
AUC of ROC = 0.805989
AUC of PRC = 0.324333
min(+P, Se) = 0.341346

-------------------------------

confusion matrix:
[[223   0]
 [ 24   1]]

stratified metric for:
demographic variable: Ethnicity
value: BLACK

overall metrics:
prevalence of IHM = 0.100806
average predicted risk of IHM = 0.06279899924993515
difference in average predicted and observed risk = -0.03800700075006486
number samples = 248
accuracy = 0.903226
precision class 0 = 0.902834
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.04
false negative rate = 0.96
false positive rate = 0.0
positive prediction rate = 0.004032
AUC of ROC = 0.710852
AUC of PRC = 0.258529
min(+P, Se) = 0.32

-------------------------------

confusion matrix:
[[480   1]
 [ 78   4]]

stratified metric for:
demographic variable: Ethnicity
value: OTHER

overall metrics:
prevalence of IHM = 0.145648
average predicted risk of IHM = 0.08711200207471848
difference in average predicted and observed risk = -0.058535997925281524
number samples = 563
accuracy = 0.85968
precision class 0 = 0.860215
precision class 1 = 0.8
recall class 0 = 0.997921
recall class 1 = 0.04878
false negative rate = 0.951219
false positive rate = 0.002079
positive prediction rate = 0.008881
AUC of ROC = 0.836621
AUC of PRC = 0.569791
min(+P, Se) = 0.564706

-------------------------------

confusion matrix:
[[654   1]
 [ 72   7]]

stratified metric for:
demographic variable: Ethnicity
value: HISPANIC

overall metrics:
prevalence of IHM = 0.107629
average predicted risk of IHM = 0.08255600184202194
difference in average predicted and observed risk = -0.02507299815797806
number samples = 734
accuracy = 0.900545
precision class 0 = 0.900826
precision class 1 = 0.875
recall class 0 = 0.998473
recall class 1 = 0.088608
false negative rate = 0.911392
false positive rate = 0.001527
positive prediction rate = 0.010899
AUC of ROC = 0.820833
AUC of PRC = 0.460123
min(+P, Se) = 0.417722

-------------------------------

confusion matrix:
[[4153    4]
 [ 454   17]]
prevalence of IHM = 0.101772
average predicted risk of IHM = 0.06729499995708466
difference in average predicted and observed risk = -0.034477000042915346
number samples = 4628
accuracy = 0.901037
precision class 0 = 0.901454
precision class 1 = 0.809524
recall class 0 = 0.999038
recall class 1 = 0.036093
false negative rate = 0.963907
false positive rate = 0.000962
positive prediction rate = 0.004538
AUC of ROC = 0.813932
AUC of PRC = 0.396613
min(+P, Se) = 0.414013

-------------------------------

==>predicting on validation



confusion matrix:
[[216   2]
 [ 17   2]]

stratified metric for:
demographic variable: Insurance
value: Private

overall metrics:
prevalence of IHM = 0.080169
average predicted risk of IHM = 0.06857199966907501
difference in average predicted and observed risk = -0.011597000330924992
number samples = 237
accuracy = 0.919831
precision class 0 = 0.927039
precision class 1 = 0.5
recall class 0 = 0.990826
recall class 1 = 0.105263
false negative rate = 0.894737
false positive rate = 0.009174
positive prediction rate = 0.016878
AUC of ROC = 0.893047
AUC of PRC = 0.385686
min(+P, Se) = 0.473684

-------------------------------

confusion matrix:
[[385   0]
 [ 47   0]]
/share/pi/boussard/eroosli_work/benchmarking/models/evaluation/metrics.py:34: RuntimeWarning: invalid value encountered in float_scalars
  prec1 = np.round(float(cf[1][1] / (cf[1][1] + cf[0][1])),6)

stratified metric for:
demographic variable: Insurance
value: Medicare

overall metrics:
prevalence of IHM = 0.108796
average predicted risk of IHM = 0.06560400128364563
difference in average predicted and observed risk = -0.043191998716354374
number samples = 432
accuracy = 0.891204
precision class 0 = 0.891204
precision class 1 = nan
recall class 0 = 1.0
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.0
positive prediction rate = 0.0
AUC of ROC = 0.822603
AUC of PRC = 0.422581
min(+P, Se) = 0.365079

-------------------------------

confusion matrix:
[[105   0]
 [ 10   3]]

stratified metric for:
demographic variable: Insurance
value: Medicaid

overall metrics:
prevalence of IHM = 0.110169
average predicted risk of IHM = 0.0928260013461113
difference in average predicted and observed risk = -0.017342998653888705
number samples = 118
accuracy = 0.915254
precision class 0 = 0.913043
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.230769
false negative rate = 0.769231
false positive rate = 0.0
positive prediction rate = 0.025424
AUC of ROC = 0.876923
AUC of PRC = 0.671712
min(+P, Se) = 0.769231

-------------------------------

confusion matrix:
[[26  0]
 [ 4  0]]
/share/pi/boussard/eroosli_work/benchmarking/models/evaluation/metrics.py:34: RuntimeWarning: invalid value encountered in float_scalars
  prec1 = np.round(float(cf[1][1] / (cf[1][1] + cf[0][1])),6)

stratified metric for:
demographic variable: Insurance
value: Other

overall metrics:
prevalence of IHM = 0.133333
average predicted risk of IHM = 0.07525700330734253
difference in average predicted and observed risk = -0.05807599669265748
number samples = 30
accuracy = 0.866667
precision class 0 = 0.866667
precision class 1 = nan
recall class 0 = 1.0
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.0
positive prediction rate = 0.0
AUC of ROC = 1.0
AUC of PRC = 1.0
min(+P, Se) = 1.0

-------------------------------

confusion matrix:
[[299   1]
 [ 37   2]]

stratified metric for:
demographic variable: Gender
value: F

overall metrics:
prevalence of IHM = 0.115044
average predicted risk of IHM = 0.08007600158452988
difference in average predicted and observed risk = -0.03496799841547012
number samples = 339
accuracy = 0.887906
precision class 0 = 0.889881
precision class 1 = 0.666667
recall class 0 = 0.996667
recall class 1 = 0.051282
false negative rate = 0.948718
false positive rate = 0.003333
positive prediction rate = 0.00885
AUC of ROC = 0.827436
AUC of PRC = 0.414474
min(+P, Se) = 0.410256

-------------------------------

confusion matrix:
[[433   1]
 [ 41   3]]

stratified metric for:
demographic variable: Gender
value: M

overall metrics:
prevalence of IHM = 0.09205
average predicted risk of IHM = 0.06413699686527252
difference in average predicted and observed risk = -0.027913003134727485
number samples = 478
accuracy = 0.912134
precision class 0 = 0.913502
precision class 1 = 0.75
recall class 0 = 0.997696
recall class 1 = 0.068182
false negative rate = 0.931818
false positive rate = 0.002304
positive prediction rate = 0.008368
AUC of ROC = 0.869554
AUC of PRC = 0.476096
min(+P, Se) = 0.522727

-------------------------------

confusion matrix:
[[388   0]
 [ 36   2]]

stratified metric for:
demographic variable: Ethnicity
value: WHITE

overall metrics:
prevalence of IHM = 0.089202
average predicted risk of IHM = 0.06082199886441231
difference in average predicted and observed risk = -0.028380001135587696
number samples = 426
accuracy = 0.915493
precision class 0 = 0.915094
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.052632
false negative rate = 0.947368
false positive rate = 0.0
positive prediction rate = 0.004695
AUC of ROC = 0.843055
AUC of PRC = 0.437018
min(+P, Se) = 0.418605

-------------------------------

confusion matrix:
[[90  0]
 [11  1]]

stratified metric for:
demographic variable: Ethnicity
value: OTHER

overall metrics:
prevalence of IHM = 0.117647
average predicted risk of IHM = 0.08148299902677536
difference in average predicted and observed risk = -0.03616400097322464
number samples = 102
accuracy = 0.892157
precision class 0 = 0.891089
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.083333
false negative rate = 0.916667
false positive rate = 0.0
positive prediction rate = 0.009804
AUC of ROC = 0.912963
AUC of PRC = 0.603499
min(+P, Se) = 0.666667

-------------------------------

confusion matrix:
[[112   1]
 [ 11   0]]

stratified metric for:
demographic variable: Ethnicity
value: ASIAN

overall metrics:
prevalence of IHM = 0.08871
average predicted risk of IHM = 0.0682469978928566
difference in average predicted and observed risk = -0.0204630021071434
number samples = 124
accuracy = 0.903226
precision class 0 = 0.910569
precision class 1 = 0.0
recall class 0 = 0.99115
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.00885
positive prediction rate = 0.008065
AUC of ROC = 0.839903
AUC of PRC = 0.269648
min(+P, Se) = 0.363636

-------------------------------

confusion matrix:
[[107   1]
 [ 17   2]]

stratified metric for:
demographic variable: Ethnicity
value: HISPANIC

overall metrics:
prevalence of IHM = 0.149606
average predicted risk of IHM = 0.08645199984312057
difference in average predicted and observed risk = -0.06315400015687941
number samples = 127
accuracy = 0.858268
precision class 0 = 0.862903
precision class 1 = 0.666667
recall class 0 = 0.990741
recall class 1 = 0.105263
false negative rate = 0.894737
false positive rate = 0.009259
positive prediction rate = 0.023622
AUC of ROC = 0.833333
AUC of PRC = 0.573362
min(+P, Se) = 0.526316

-------------------------------

confusion matrix:
[[35  0]
 [ 3  0]]
/share/pi/boussard/eroosli_work/benchmarking/models/evaluation/metrics.py:34: RuntimeWarning: invalid value encountered in float_scalars
  prec1 = np.round(float(cf[1][1] / (cf[1][1] + cf[0][1])),6)

stratified metric for:
demographic variable: Ethnicity
value: BLACK

overall metrics:
prevalence of IHM = 0.078947
average predicted risk of IHM = 0.10895700007677078
difference in average predicted and observed risk = 0.03001000007677078
number samples = 38
accuracy = 0.921053
precision class 0 = 0.921053
precision class 1 = nan
recall class 0 = 1.0
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.0
positive prediction rate = 0.0
AUC of ROC = 0.952381
AUC of PRC = 0.776786
min(+P, Se) = 0.666667

-------------------------------

confusion matrix:
[[732   2]
 [ 78   5]]
prevalence of IHM = 0.101591
average predicted risk of IHM = 0.07075099647045135
difference in average predicted and observed risk = -0.030840003529548646
number samples = 817
accuracy = 0.902081
precision class 0 = 0.903704
precision class 1 = 0.714286
recall class 0 = 0.997275
recall class 1 = 0.060241
false negative rate = 0.939759
false positive rate = 0.002725
positive prediction rate = 0.008568
AUC of ROC = 0.852746
AUC of PRC = 0.453867
min(+P, Se) = 0.46988

-------------------------------

Epoch 00002: saving model to models/outputs/starr/keras_states/2020-06-01_10-11/k_clstms.none.epoch2.state
Epoch 3/100
 - 260s - loss: 0.2863 - val_loss: 0.2546

==>predicting on train



confusion matrix:
[[2155    0]
 [ 244   11]]

stratified metric for:
demographic variable: Insurance
value: Medicare

overall metrics:
prevalence of IHM = 0.105809
average predicted risk of IHM = 0.07655400037765503
difference in average predicted and observed risk = -0.02925499962234497
number samples = 2410
accuracy = 0.898755
precision class 0 = 0.898291
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.043137
false negative rate = 0.956863
false positive rate = 0.0
positive prediction rate = 0.004564
AUC of ROC = 0.823397
AUC of PRC = 0.445645
min(+P, Se) = 0.440613

-------------------------------

confusion matrix:
[[1174    5]
 [ 114    4]]

stratified metric for:
demographic variable: Insurance
value: Private

overall metrics:
prevalence of IHM = 0.090979
average predicted risk of IHM = 0.08233299851417542
difference in average predicted and observed risk = -0.00864600148582459
number samples = 1297
accuracy = 0.90825
precision class 0 = 0.911491
precision class 1 = 0.444444
recall class 0 = 0.995759
recall class 1 = 0.033898
false negative rate = 0.966102
false positive rate = 0.004241
positive prediction rate = 0.006939
AUC of ROC = 0.833477
AUC of PRC = 0.344848
min(+P, Se) = 0.411765

-------------------------------

confusion matrix:
[[656   0]
 [ 68   6]]

stratified metric for:
demographic variable: Insurance
value: Medicaid

overall metrics:
prevalence of IHM = 0.10137
average predicted risk of IHM = 0.08824600279331207
difference in average predicted and observed risk = -0.013123997206687929
number samples = 730
accuracy = 0.906849
precision class 0 = 0.906077
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.081081
false negative rate = 0.918919
false positive rate = 0.0
positive prediction rate = 0.008219
AUC of ROC = 0.826137
AUC of PRC = 0.439211
min(+P, Se) = 0.432432

-------------------------------

confusion matrix:
[[166   1]
 [ 20   4]]

stratified metric for:
demographic variable: Insurance
value: Other

overall metrics:
prevalence of IHM = 0.125654
average predicted risk of IHM = 0.08613499999046326
difference in average predicted and observed risk = -0.03951900000953673
number samples = 191
accuracy = 0.890052
precision class 0 = 0.892473
precision class 1 = 0.8
recall class 0 = 0.994012
recall class 1 = 0.166667
false negative rate = 0.833333
false positive rate = 0.005988
positive prediction rate = 0.026178
AUC of ROC = 0.881238
AUC of PRC = 0.682583
min(+P, Se) = 0.625

-------------------------------

confusion matrix:
[[2471    3]
 [ 243   12]]

stratified metric for:
demographic variable: Gender
value: M

overall metrics:
prevalence of IHM = 0.093441
average predicted risk of IHM = 0.07467900216579437
difference in average predicted and observed risk = -0.018761997834205624
number samples = 2729
accuracy = 0.909857
precision class 0 = 0.910464
precision class 1 = 0.8
recall class 0 = 0.998787
recall class 1 = 0.047059
false negative rate = 0.952941
false positive rate = 0.001213
positive prediction rate = 0.005497
AUC of ROC = 0.829925
AUC of PRC = 0.399336
min(+P, Se) = 0.428016

-------------------------------

confusion matrix:
[[1680    3]
 [ 203   13]]

stratified metric for:
demographic variable: Gender
value: F

overall metrics:
prevalence of IHM = 0.113744
average predicted risk of IHM = 0.08865399658679962
difference in average predicted and observed risk = -0.025090003413200376
number samples = 1899
accuracy = 0.891522
precision class 0 = 0.892193
precision class 1 = 0.8125
recall class 0 = 0.998217
recall class 1 = 0.060185
false negative rate = 0.939815
false positive rate = 0.001783
positive prediction rate = 0.008425
AUC of ROC = 0.826544
AUC of PRC = 0.446116
min(+P, Se) = 0.447964

-------------------------------

confusion matrix:
[[547   2]
 [ 72   5]]

stratified metric for:
demographic variable: Ethnicity
value: ASIAN

overall metrics:
prevalence of IHM = 0.123003
average predicted risk of IHM = 0.09137699753046036
difference in average predicted and observed risk = -0.031626002469539644
number samples = 626
accuracy = 0.881789
precision class 0 = 0.883683
precision class 1 = 0.714286
recall class 0 = 0.996357
recall class 1 = 0.064935
false negative rate = 0.935065
false positive rate = 0.003643
positive prediction rate = 0.011182
AUC of ROC = 0.857379
AUC of PRC = 0.451267
min(+P, Se) = 0.493976

-------------------------------

confusion matrix:
[[2249    0]
 [ 205    3]]

stratified metric for:
demographic variable: Ethnicity
value: WHITE

overall metrics:
prevalence of IHM = 0.084656
average predicted risk of IHM = 0.07028000056743622
difference in average predicted and observed risk = -0.014375999432563777
number samples = 2457
accuracy = 0.916565
precision class 0 = 0.916463
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.014423
false negative rate = 0.985577
false positive rate = 0.0
positive prediction rate = 0.001221
AUC of ROC = 0.823734
AUC of PRC = 0.345861
min(+P, Se) = 0.367257

-------------------------------

confusion matrix:
[[221   2]
 [ 24   1]]

stratified metric for:
demographic variable: Ethnicity
value: BLACK

overall metrics:
prevalence of IHM = 0.100806
average predicted risk of IHM = 0.07961200177669525
difference in average predicted and observed risk = -0.021193998223304755
number samples = 248
accuracy = 0.895161
precision class 0 = 0.902041
precision class 1 = 0.333333
recall class 0 = 0.991031
recall class 1 = 0.04
false negative rate = 0.96
false positive rate = 0.008969
positive prediction rate = 0.012097
AUC of ROC = 0.699552
AUC of PRC = 0.266359
min(+P, Se) = 0.357143

-------------------------------

confusion matrix:
[[481   0]
 [ 76   6]]

stratified metric for:
demographic variable: Ethnicity
value: OTHER

overall metrics:
prevalence of IHM = 0.145648
average predicted risk of IHM = 0.09713999927043915
difference in average predicted and observed risk = -0.04850800072956085
number samples = 563
accuracy = 0.865009
precision class 0 = 0.863555
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.073171
false negative rate = 0.926829
false positive rate = 0.0
positive prediction rate = 0.010657
AUC of ROC = 0.848639
AUC of PRC = 0.592848
min(+P, Se) = 0.609756

-------------------------------

confusion matrix:
[[653   2]
 [ 69  10]]

stratified metric for:
demographic variable: Ethnicity
value: HISPANIC

overall metrics:
prevalence of IHM = 0.107629
average predicted risk of IHM = 0.09242500364780426
difference in average predicted and observed risk = -0.015203996352195742
number samples = 734
accuracy = 0.90327
precision class 0 = 0.904432
precision class 1 = 0.833333
recall class 0 = 0.996947
recall class 1 = 0.126582
false negative rate = 0.873418
false positive rate = 0.003053
positive prediction rate = 0.016349
AUC of ROC = 0.826128
AUC of PRC = 0.46467
min(+P, Se) = 0.455696

-------------------------------

confusion matrix:
[[4151    6]
 [ 446   25]]
prevalence of IHM = 0.101772
average predicted risk of IHM = 0.08041299879550934
difference in average predicted and observed risk = -0.021359001204490663
number samples = 4628
accuracy = 0.902334
precision class 0 = 0.90298
precision class 1 = 0.806452
recall class 0 = 0.998557
recall class 1 = 0.053079
false negative rate = 0.946921
false positive rate = 0.001443
positive prediction rate = 0.006698
AUC of ROC = 0.828947
AUC of PRC = 0.418968
min(+P, Se) = 0.429448

-------------------------------

==>predicting on validation



confusion matrix:
[[216   2]
 [ 17   2]]

stratified metric for:
demographic variable: Insurance
value: Private

overall metrics:
prevalence of IHM = 0.080169
average predicted risk of IHM = 0.08398199826478958
difference in average predicted and observed risk = 0.003812998264789577
number samples = 237
accuracy = 0.919831
precision class 0 = 0.927039
precision class 1 = 0.5
recall class 0 = 0.990826
recall class 1 = 0.105263
false negative rate = 0.894737
false positive rate = 0.009174
positive prediction rate = 0.016878
AUC of ROC = 0.875664
AUC of PRC = 0.352948
min(+P, Se) = 0.5

-------------------------------

confusion matrix:
[[385   0]
 [ 47   0]]
/share/pi/boussard/eroosli_work/benchmarking/models/evaluation/metrics.py:34: RuntimeWarning: invalid value encountered in float_scalars
  prec1 = np.round(float(cf[1][1] / (cf[1][1] + cf[0][1])),6)

stratified metric for:
demographic variable: Insurance
value: Medicare

overall metrics:
prevalence of IHM = 0.108796
average predicted risk of IHM = 0.0788239985704422
difference in average predicted and observed risk = -0.029972001429557804
number samples = 432
accuracy = 0.891204
precision class 0 = 0.891204
precision class 1 = nan
recall class 0 = 1.0
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.0
positive prediction rate = 0.0
AUC of ROC = 0.835424
AUC of PRC = 0.442307
min(+P, Se) = 0.446809

-------------------------------

confusion matrix:
[[105   0]
 [ 10   3]]

stratified metric for:
demographic variable: Insurance
value: Medicaid

overall metrics:
prevalence of IHM = 0.110169
average predicted risk of IHM = 0.10096000134944916
difference in average predicted and observed risk = -0.009208998650550845
number samples = 118
accuracy = 0.915254
precision class 0 = 0.913043
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.230769
false negative rate = 0.769231
false positive rate = 0.0
positive prediction rate = 0.025424
AUC of ROC = 0.880586
AUC of PRC = 0.655033
min(+P, Se) = 0.769231

-------------------------------

confusion matrix:
[[26  0]
 [ 4  0]]
/share/pi/boussard/eroosli_work/benchmarking/models/evaluation/metrics.py:34: RuntimeWarning: invalid value encountered in float_scalars
  prec1 = np.round(float(cf[1][1] / (cf[1][1] + cf[0][1])),6)

stratified metric for:
demographic variable: Insurance
value: Other

overall metrics:
prevalence of IHM = 0.133333
average predicted risk of IHM = 0.08358199894428253
difference in average predicted and observed risk = -0.049751001055717475
number samples = 30
accuracy = 0.866667
precision class 0 = 0.866667
precision class 1 = nan
recall class 0 = 1.0
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.0
positive prediction rate = 0.0
AUC of ROC = 1.0
AUC of PRC = 1.0
min(+P, Se) = 1.0

-------------------------------

confusion matrix:
[[299   1]
 [ 37   2]]

stratified metric for:
demographic variable: Gender
value: F

overall metrics:
prevalence of IHM = 0.115044
average predicted risk of IHM = 0.09383600205183029
difference in average predicted and observed risk = -0.021207997948169702
number samples = 339
accuracy = 0.887906
precision class 0 = 0.889881
precision class 1 = 0.666667
recall class 0 = 0.996667
recall class 1 = 0.051282
false negative rate = 0.948718
false positive rate = 0.003333
positive prediction rate = 0.00885
AUC of ROC = 0.826581
AUC of PRC = 0.416396
min(+P, Se) = 0.422222

-------------------------------

confusion matrix:
[[433   1]
 [ 41   3]]

stratified metric for:
demographic variable: Gender
value: M

overall metrics:
prevalence of IHM = 0.09205
average predicted risk of IHM = 0.07649800181388855
difference in average predicted and observed risk = -0.015551998186111457
number samples = 478
accuracy = 0.912134
precision class 0 = 0.913502
precision class 1 = 0.75
recall class 0 = 0.997696
recall class 1 = 0.068182
false negative rate = 0.931818
false positive rate = 0.002304
positive prediction rate = 0.008368
AUC of ROC = 0.879661
AUC of PRC = 0.482421
min(+P, Se) = 0.568182

-------------------------------

confusion matrix:
[[388   0]
 [ 36   2]]

stratified metric for:
demographic variable: Ethnicity
value: WHITE

overall metrics:
prevalence of IHM = 0.089202
average predicted risk of IHM = 0.07452099770307541
difference in average predicted and observed risk = -0.014681002296924595
number samples = 426
accuracy = 0.915493
precision class 0 = 0.915094
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.052632
false negative rate = 0.947368
false positive rate = 0.0
positive prediction rate = 0.004695
AUC of ROC = 0.846717
AUC of PRC = 0.428397
min(+P, Se) = 0.5

-------------------------------

confusion matrix:
[[90  0]
 [11  1]]

stratified metric for:
demographic variable: Ethnicity
value: OTHER

overall metrics:
prevalence of IHM = 0.117647
average predicted risk of IHM = 0.09021999686956406
difference in average predicted and observed risk = -0.027427003130435945
number samples = 102
accuracy = 0.892157
precision class 0 = 0.891089
precision class 1 = 1.0
recall class 0 = 1.0
recall class 1 = 0.083333
false negative rate = 0.916667
false positive rate = 0.0
positive prediction rate = 0.009804
AUC of ROC = 0.910185
AUC of PRC = 0.617676
min(+P, Se) = 0.615385

-------------------------------

confusion matrix:
[[112   1]
 [ 11   0]]

stratified metric for:
demographic variable: Ethnicity
value: ASIAN

overall metrics:
prevalence of IHM = 0.08871
average predicted risk of IHM = 0.08224999904632568
difference in average predicted and observed risk = -0.006460000953674314
number samples = 124
accuracy = 0.903226
precision class 0 = 0.910569
precision class 1 = 0.0
recall class 0 = 0.99115
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.00885
positive prediction rate = 0.008065
AUC of ROC = 0.842317
AUC of PRC = 0.295276
min(+P, Se) = 0.454545

-------------------------------

confusion matrix:
[[107   1]
 [ 17   2]]

stratified metric for:
demographic variable: Ethnicity
value: HISPANIC

overall metrics:
prevalence of IHM = 0.149606
average predicted risk of IHM = 0.09967999905347824
difference in average predicted and observed risk = -0.04992600094652175
number samples = 127
accuracy = 0.858268
precision class 0 = 0.862903
precision class 1 = 0.666667
recall class 0 = 0.990741
recall class 1 = 0.105263
false negative rate = 0.894737
false positive rate = 0.009259
positive prediction rate = 0.023622
AUC of ROC = 0.861598
AUC of PRC = 0.594338
min(+P, Se) = 0.6

-------------------------------

confusion matrix:
[[35  0]
 [ 3  0]]
/share/pi/boussard/eroosli_work/benchmarking/models/evaluation/metrics.py:34: RuntimeWarning: invalid value encountered in float_scalars
  prec1 = np.round(float(cf[1][1] / (cf[1][1] + cf[0][1])),6)

stratified metric for:
demographic variable: Ethnicity
value: BLACK

overall metrics:
prevalence of IHM = 0.078947
average predicted risk of IHM = 0.12025099992752075
difference in average predicted and observed risk = 0.04130399992752075
number samples = 38
accuracy = 0.921053
precision class 0 = 0.921053
precision class 1 = nan
recall class 0 = 1.0
recall class 1 = 0.0
false negative rate = 1.0
false positive rate = 0.0
positive prediction rate = 0.0
AUC of ROC = 0.961905
AUC of PRC = 0.655556
min(+P, Se) = 0.6

-------------------------------

confusion matrix:
[[732   2]
 [ 78   5]]
prevalence of IHM = 0.101591
average predicted risk of IHM = 0.08369199931621552
difference in average predicted and observed risk = -0.017899000683784486
number samples = 817
accuracy = 0.902081
precision class 0 = 0.903704
precision class 1 = 0.714286
recall class 0 = 0.997275
recall class 1 = 0.060241
false negative rate = 0.939759
false positive rate = 0.002725
positive prediction rate = 0.008568
AUC of ROC = 0.858212
AUC of PRC = 0.454911
min(+P, Se) = 0.493976

-------------------------------

Epoch 00003: saving model to models/outputs/starr/keras_states/2020-06-01_10-11/k_clstms.none.epoch3.state
Epoch 4/100
